@{
    ViewBag.Title = "Home Page";
}

<!-- Setting up connection with the database -->
@using WebMatrix.Data

@{
    <!-- accessing joined data between BoardGame, GameCategory, and Category -->
    var db = Database.Open("BoardGame");


    var selectQueryString = @"
SELECT
b.Name,
b.Description,
b.YearPublished,
b.MinPlayers,
b.MaxPlayers,
b.ComAgeRec,
b.LanguageEase,
b.BestPlayers,
b.NumOwned,
b.NumWant,
b.NumWish,
b.MfgPlaytime,
b.ComMinPlayTime,
b.ComMaxPlayTime,
b.MfgAgeRec,
b.NumAlternates,
b.NumExpansions,
b.NumImplementations,
b.Family,
b.RankInboardgame,
b.RankInstrategygames,
b.RankInfamilygames,
b.RankInthematic,
c.Category AS Category,
b.ImagePath
FROM GameCategory AS gc
INNER JOIN Category AS c ON gc.Category = c.CategoryID
INNER JOIN BoardGame AS b ON gc.BGGId = b.BGGId
ORDER BY b.Name";

    <!-- category buttons query -->
    var categoryQuery = "SELECT DISTINCT Category FROM Category ORDER BY Category";
    var categories = db.Query(categoryQuery);
}

<main>
    <html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <style>
            h1 {
                margin-bottom: 20px;
            }

            table img {
                max-width: 80px;
                border-radius: 8px;
            }

            .table-wrapper {
                max-height: 600px;
                overflow-y: auto;
            }

            .card img {
                max-height: 200px;
                object-fit: cover;
            }

            .category-buttons {
                margin-top: 15px;
                margin-bottom: 15px;
            }

                .category-buttons button {
                    margin: 3px;
                    padding: 6px 12px;
                    border-radius: 6px;
                    border: 1px solid #007bff;
                    background-color: white;
                    color: #007bff;
                    cursor: pointer;
                }

                    .category-buttons button.active {
                        background-color: #007bff;
                        color: white;
                    }
        </style>

        <div class="container">
            <h1>Board Games</h1>

            <!-- search field -->
            <b>
                Search Board Games:
                <input id="entireSearch" type="text" placeholder="Search here" class="form-control" style="width: 300px; display: inline-block; margin-left: 10px;">
            </b>

            <!-- category filter buttons -->
            <div class="category-buttons">
                <b>Filter by Category:</b><br />
                <!-- All button -->
                <button class="category-btn active" data-category="All">All</button>
                @foreach (var row in categories)
                {
                    <button class="category-btn" data-category="@row.Category">@row.Category</button>
                }
            </div>

            <!-- view buttons -->
            <div style="margin-top:10px;">
                <b>View:</b>
                <button id="showTable" class="btn btn-primary btn-sm" onclick="showTable()">Table</button>
                <button id="showCards" class="btn btn-secondary btn-sm" onclick="showCards()">Card</button>
            </div>

            <!-- board game table details -->
            <div id="tableView">
                <div class="table-wrapper mt-3">
                    <table class="table table-striped table-hover table-bordered align-middle">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Year Published</th>
                                <th>Minimum Player(s)</th>
                                <th>Maximum Player(s)</th>
                                <th>ComAgeRec</th>
                                <th>LanguageEase</th>
                                <th>BestPlayers</th>
                                <th>NumOwned</th>
                                <th>NumWant</th>
                                <th>NumWish</th>
                                <th>MfgPlaytime</th>
                                <th>ComMinPlayTime</th>
                                <th>ComMaxPlayTime</th>
                                <th>MfgAgeRec</th>
                                <th>NumAlternates</th>
                                <th>NumExpansions</th>
                                <th>NumImplementations</th>
                                <th>Family</th>
                                <th>RankInboardgame</th>
                                <th>RankInstrategygames</th>
                                <th>RankInfamilygames</th>
                                <th>RankInthematic</th>
                                <th>Category</th>
                                <th>Image</th>
                            </tr>
                        </thead>

                        <tbody id="content">
                            @foreach (var row in db.Query(selectQueryString))
                            {
                                <tr data-category="@row.Category">
                                    <td>@row.Name</td>
                                    <td>@row.Description</td>
                                    <td>@row.YearPublished</td>
                                    <td>@row.MinPlayers</td>
                                    <td>@row.MaxPlayers</td>
                                    <td>@row.ComAgeRec</td>
                                    <td>@row.LanguageEase</td>
                                    <td>@row.BestPlayers</td>
                                    <td>@row.NumOwned</td>
                                    <td>@row.NumWant</td>
                                    <td>@row.NumWish</td>
                                    <td>@row.MfgPlaytime</td>
                                    <td>@row.ComMinPlayTime</td>
                                    <td>@row.ComMaxPlayTime</td>
                                    <td>@row.MfgAgeRec</td>
                                    <td>@row.NumAlternates</td>
                                    <td>@row.NumExpansions</td>
                                    <td>@row.NumImplementations</td>
                                    <td>@row.Family</td>
                                    <td>@row.RankInboardgame</td>
                                    <td>@row.RankInstrategygames</td>
                                    <td>@row.RankInfamilygames</td>
                                    <td>@row.RankInthematic</td>
                                    <td>@row.Category</td>
                                    <td><img src="@row.ImagePath" alt="@row.Name" style="max-width:80px; border-radius:8px;"></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- card layout -->
            <div id="cardView" class="container my-4">
                <div id="cardContent" class="row justify-content-center">
                    @foreach (var row in db.Query(selectQueryString))
                    {
                        <div class="col-md-4 d-flex justify-content-center mb-4 card-item" data-category="@row.Category">
                            <div class="card shadow-sm" style="width: 20rem; min-height: 100%;">
                                <img src="@row.ImagePath" class="card-img-top" alt="@row.Name">

                                <div class="card-body">
                                    <h5 class="card-title">@row.Name</h5>
                                    <p class="card-text">@row.Description</p>
                                </div>

                                <ul class="list-group list-group-flush text-start">
                                    <li class="list-group-item"><b>Year:</b> @row.YearPublished</li>
                                    <li class="list-group-item"><b>Players:</b> @row.MinPlayers - @row.MaxPlayers</li>
                                    <li class="list-group-item"><b>Age Rec:</b> @row.ComAgeRec</li>
                                    <li class="list-group-item"><b>Playtime:</b> @row.MfgPlaytime</li>
                                    <li class="list-group-item"><b>Family:</b> @row.Family</li>
                                    <li class="list-group-item"><b>Category:</b> @row.Category</li>
                                    <li class="list-group-item"><b>Rank:</b> @row.RankInboardgame</li>
                                </ul>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <!--search and filter script -->
            <script>

                // category button filter
                $(".category-btn").on("click", function () {
                    var selected = $(this).data("category");
                    $(".category-btn").removeClass("active");
                    $(this).addClass("active");

                    // table filter
                    $("#content tr").each(function () {
                        var cat = $(this).data("category");
                        $(this).toggle(selected === "All" || cat === selected);
                    });

                    // card filter
                    $("#cardContent .card-item").each(function () {
                        var cat = $(this).data("category");
                        $(this).toggle(selected === "All" || cat === selected);
                    });
                });

                //table search script
                $(function () {
                    $("#entireSearch").on("keyup", function () {
                        var value = $(this).val().toLowerCase();
                        $("#content tr").filter(function () {
                            var name = $(this).find("td:first").text().toLowerCase();
                            $(this).toggle(name.indexOf(value) > -1);
                        });
                    });
                });

                //card search script
                $(function () {
                    $("#entireSearch").on("keyup", function () {
                        var value = $(this).val().toLowerCase();
                        $("#cardContent .card").filter(function () {
                            var name = $(this).find(".card-title").text().toLowerCase();
                            $(this).toggle(name.indexOf(value) > -1);
                        });
                    });
                });

                // View toggle between table and card script
                document.getElementById("cardView").style.display = "none";

                function showTable() {
                    document.getElementById("tableView").style.display = "block";
                    document.getElementById("cardView").style.display = "none";
                    document.getElementById("showTable").classList.add("btn-primary");
                    document.getElementById("showTable").classList.remove("btn-secondary");
                    document.getElementById("showCards").classList.add("btn-secondary");
                    document.getElementById("showCards").classList.remove("btn-primary");
                }

                function showCards() {
                    document.getElementById("cardView").style.display = "block";
                    document.getElementById("tableView").style.display = "none";
                    document.getElementById("showCards").classList.add("btn-primary");
                    document.getElementById("showCards").classList.remove("btn-secondary");
                    document.getElementById("showTable").classList.add("btn-secondary");
                    document.getElementById("showTable").classList.remove("btn-primary");
                }

            </script>


        </div>
    </head>
    <body>
</main>
